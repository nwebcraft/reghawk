# Tasks: 官公庁情報更新通知システム（RegHawk）

## 1. プロジェクト基盤構築

- [ ] 1.1 Rubyプロジェクトの初期化（Gemfile作成、基本構成）
- [ ] 1.2 AWS SAMテンプレート（template.yaml）の作成
- [ ] 1.3 環境変数・シークレット管理の設計（.env, AWS Secrets Manager）
- [ ] 1.4 ローカル開発環境のセットアップ手順ドキュメント化

## 2. データベース構築

- [ ] 2.1 Neon PostgreSQLアカウント作成・プロジェクト設定
- [ ] 2.2 articlesテーブルのスキーマ定義・マイグレーション作成
- [ ] 2.3 データベース接続モジュールの実装（lib/database.rb）
- [ ] 2.4 接続プールとタイムアウト設定

## 3. RSSフィード取得機能

- [ ] 3.1 RSSフェッチャーモジュールの実装（lib/rss_fetcher.rb）
- [ ] 3.2 RSS 1.0 / RSS 2.0 / Atomパーサーの統一インターフェース
- [ ] 3.3 HTTPリダイレクト対応・タイムアウト処理
- [ ] 3.4 6サイト分のフィード設定定義
- [ ] 3.5 RSSフェッチャーのユニットテスト

## 4. 記事保存・差分検知機能

- [ ] 4.1 記事リポジトリモジュールの実装（lib/article_repository.rb）
- [ ] 4.2 URL重複チェックによる差分検知ロジック
- [ ] 4.3 新規記事の一括保存処理
- [ ] 4.4 記事リポジトリのユニットテスト

## 5. AI判定・要約機能

- [ ] 5.1 Gemini APIクライアントの実装（lib/gemini_client.rb）
- [ ] 5.2 関心領域判定プロンプトの設計・実装（Step 1）
- [ ] 5.3 影響分析生成プロンプトの設計・実装（Step 2）
- [ ] 5.4 AIアナライザーモジュールの実装（lib/ai_analyzer.rb）
- [ ] 5.5 レスポンスパース・エラーハンドリング
- [ ] 5.6 AI処理のユニットテスト（モック使用）

## 6. 通知機能

- [ ] 6.1 LINE公式アカウント作成・Messaging API設定
- [ ] 6.2 LINE通知クライアントの実装（lib/line_notifier.rb）
- [ ] 6.3 通知メッセージフォーマットの実装
- [ ] 6.4 通知送信のユニットテスト（モック使用）

## 7. Lambda統合

- [ ] 7.1 Lambdaハンドラーの実装（lib/handler.rb）
- [ ] 7.2 メイン処理フローの統合（取得→差分検知→AI判定→通知→保存）
- [ ] 7.3 エラーハンドリング・ロギング
- [ ] 7.4 EventBridgeスケジュール設定（1日2回: 9:00/18:00 JST）

## 8. テスト・デプロイ

- [ ] 8.1 結合テストの作成・実行
- [ ] 8.2 SAM localでのローカルテスト
- [ ] 8.3 AWS環境へのデプロイ（sam deploy）
- [ ] 8.4 本番環境での動作確認
- [ ] 8.5 モニタリング・アラート設定（CloudWatch）

## 9. 運用準備

- [ ] 9.1 運用手順書の作成
- [ ] 9.2 トラブルシューティングガイドの作成
- [ ] 9.3 RSS URL疎通確認スクリプトの整備

## Dependencies

- タスク3.x（RSSフェッチャー）と4.x（記事保存）は並行して実装可能
- タスク5.x（AI判定）は3.xと4.xの完了後に統合
- タスク6.x（通知）は独立して実装可能
- タスク7.x（Lambda統合）は3.x〜6.xの完了後
- タスク8.x（テスト・デプロイ）は7.xの完了後
